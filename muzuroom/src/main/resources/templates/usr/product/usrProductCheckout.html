<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<div th:replace="~{usr/include/usrindex/head ::head}"></div>

	<input type="hidden" id="roomSeq" name="seq" />
	<input type="hidden" id="orderId" name="orderId" th:value="${orderId}"/>
	<input type="hidden" id="userId" th:value="${reservationData.userinfo_seq}" />
	<input type="hidden" id="TotalPrice" th:value="${reservationData.totalPrice}"/>
	
	
	
	<!--Breadcrumb start-->
	<div class="container">
		<div class="row">
			<div class="col-12 py-4">
				<nav aria-label="breadcrumb">
					<ol class="breadcrumb mb-0">
						<li class="breadcrumb-item"><a href="usr/usrindex/usrIndexView">Home</a></li>
						<li class="breadcrumb-item"><a href="/usrProductList">연습실</a></li>
						<li class="breadcrumb-item"><a href="/usr/product/usrProductItem">루아보</a></li>
						<li class="breadcrumb-item active" aria-current="page">예역 결제</li>
					</ol>
				</nav>
			</div>
			<div class="col-12">
				<!--Heading-->
				<div class="my-5">
					<h1 class="mb-0">예약 결제</h1>
				</div>
			</div>
		</div>
	</div>
	<!--Breadcrumb end-->
	<!--Shopping checkout start-->
	<section class="pt-lg-4 pb-lg-8">
		<div class="container">
			<div class="row gx-lg-6 gy-4 gy-lg-0">
				<!--Shopping checkout detail-->
				<div class="col-lg-8">
					<div class="">
<!-- 						<div class="d-flex justify-content-between align-items-center mb-2"> -->
<!-- 							<h2 class="fs-5">예약자 주소</h2> -->
<!-- 							<a href="/user/template/FreshCart-1.4.0/account-personal-info.html" class="text-link" >주소 추가 -->
<!-- 								</a> -->
<!-- 						</div> -->
<!-- 						<div class="d-flex justify-content-between align-items-lg-center flex-column flex-md-row gap-2"> -->
<!-- 							<p class="mb-0 d-flex align-items-center gap-2"> -->
<!-- 								<svg width="16" height="16" viewBox="0 0 16 16" fill="none" -->
<!-- 									xmlns="http://www.w3.org/2000/svg"> -->
<!-- 									<path -->
<!-- 										d="M13.3327 6.66668C13.3327 9.99534 9.64002 13.462 8.40002 14.5327C8.2845 14.6195 8.14388 14.6665 7.99935 14.6665C7.85482 14.6665 7.7142 14.6195 7.59868 14.5327C6.35868 13.462 2.66602 9.99534 2.66602 6.66668C2.66602 5.25219 3.22792 3.89563 4.22811 2.89544C5.22831 1.89525 6.58486 1.33334 7.99935 1.33334C9.41384 1.33334 10.7704 1.89525 11.7706 2.89544C12.7708 3.89563 13.3327 5.25219 13.3327 6.66668Z" -->
<!-- 										stroke="#DC2626" stroke-linecap="round" stroke-linejoin="round" /> -->
<!-- 									<path -->
<!-- 										d="M8 8.66666C9.10457 8.66666 10 7.77123 10 6.66666C10 5.56209 9.10457 4.66666 8 4.66666C6.89543 4.66666 6 5.56209 6 6.66666C6 7.77123 6.89543 8.66666 8 8.66666Z" -->
<!-- 										stroke="#DC2626" stroke-linecap="round" stroke-linejoin="round" /> -->
<!-- 								</svg> -->
<!-- 								서울시 노원구 월계동  -->
<!-- 							</p> -->
<!-- 							<a class="text-link" data-bs-toggle="offcanvas" href="#offcanvasChange" -->
<!-- 								aria-controls="offcanvasChange">주소 변경</a> -->
<!-- 						</div> -->
						<div>
<!-- 							<div class="d-flex align-items-center mt-5 mb-2 justify-content-between"> -->
<!-- 								<h3 class="fs-5">예약자 연락처</h3> -->
<!-- 								<a href="#!" class="text-link">로그인</a> -->
<!-- 							</div> -->
<!-- 							<form> -->
<!-- 								<div class="mb-3"> -->
<!-- 									<label for="email" class="visually-hidden"></label> -->
<!-- 									<input type="email" class="form-control" name="email" id="email" -->
<!-- 										placeholder="연락 가능한 Email 혹은 전화번호" required /> -->

<!-- 								</div> -->
<!-- 								<div class="form-check"> -->
<!-- 									<input class="form-check-input" type="checkbox" value="" id="emailOfferNews" -->
<!-- 										required /> -->
<!-- 									<label class="form-check-label" for="emailOfferNews">이메일 또는 문자로 정보받기</label> -->

<!-- 								</div> -->
<!-- 							</form> -->
<!-- 							<form> -->
<!-- 								<div class="mb-3 py-2"> -->
<!-- 									<div class="d-flex align-items-center mt-5 mb-2 justify-content-between"> -->
<!-- 										<h3 class="fs-5">선택 확인</h3> -->
<!-- 									</div> -->
<!-- 									<div class="form-check border-bottom"> -->
<!-- 										<input class="form-check-input" type="radio" name="flexRadio" -->
<!-- 											id="flexRadio" checked disabled> -->
<!-- 										<label class="form-check-label" for="flexRadio"> -->
<!-- 										시간제 개인 연습실 (목관악, 현악) ￦4,000/시간 -->
<!-- 										</label> -->
									
<!-- 									</div> -->
<!-- 									<div class="d-flex align-items-center mt-5 mb-2 justify-content-between"> -->
<!-- 										<h3 class="fs-5">사용 시간</h3> -->
<!-- 									</div> -->
<!-- 									 <select class="form-select" aria-label="Default select -->
<!--                                                         example"> -->
<!--                                                 <option selected>1시간 -->
<!--                                                 </option> -->
<!--                                                 <option value="1">2시간</option> -->
<!--                                                 <option value="2">3시간</option> -->
<!--                                                 <option value="3">4시간</option> -->
<!-- 												<option value="4">5시간</option> -->
<!-- 												<option value="5">6시간 이상</option> -->
<!--                                                 </select> -->
									
									
<!-- 									<div class="d-flex align-items-center mt-5 mb-2 justify-content-between py-2"> -->
<!-- 										<h3 class="fs-5">옵션</h3> -->
<!-- 									</div> -->
<!-- 									<div class="form-check mb-2"> -->
<!-- 										input -->
<!-- 										<input class="form-check-input" type="checkbox" value="" id="Brand1" -->
<!-- 											checked /> -->
<!-- 										<label class="form-check-label" for="Brand1">마이크</label> -->
<!-- 									</div> -->
<!-- 									form check -->
<!-- 									<div class="form-check mb-2"> -->
<!-- 										input -->
<!-- 										<input class="form-check-input" type="checkbox" value="" id="Brand2" /> -->
<!-- 										<label class="form-check-label" for="Brand2">큐브 EX 앰프</label> -->
<!-- 									</div> -->
<!-- 									form check -->
<!-- 									<div class="form-check mb-2"> -->
<!-- 										input -->
<!-- 										<input class="form-check-input" type="checkbox" value="" id="Brand3" /> -->
<!-- 										<label class="form-check-label" for="Brand3">헤드폰</label> -->
<!-- 									</div> -->
<!-- 									form check -->
<!-- 									<div class="form-check mb-2"> -->
<!-- 										input -->
<!-- 										<input class="form-check-input" type="checkbox" value="" id="Brand4" /> -->
<!-- 										<label class="form-check-label" for="Brand4">통기타</label> -->
<!-- 									</div> -->
<!-- 									<div class="form-check mb-2"> -->
<!-- 										input -->
<!-- 										<input class="form-check-input" type="checkbox" value="" id="Brand5" /> -->
<!-- 										<label class="form-check-label" for="Brand4">기타앰프</label> -->
<!-- 									</div> -->
<!-- 									<div class="form-check mb-2"> -->
<!-- 										input -->
<!-- 										<input class="form-check-input" type="checkbox" value="" id="Brand6" /> -->
<!-- 										<label class="form-check-label" for="Brand4">블루투스 스피커</label> -->
<!-- 									</div> -->
<!-- 									<div class="form-check mb-2"> -->
<!-- 										input -->
<!-- 										<input class="form-check-input" type="checkbox" value="" id="Brand7" /> -->
<!-- 										<label class="form-check-label" for="Brand4">보면대</label> -->
<!-- 									</div> -->
<!-- 									<div class="form-check mb-2"> -->
<!-- 										input -->
<!-- 										<input class="form-check-input" type="checkbox" value="" id="Brand8" /> -->
<!-- 										<label class="form-check-label" for="Brand4">HP 삼각대</label> -->
<!-- 									</div> -->
									
<!-- 								</div> -->
								
<!-- 							</form> -->
						</div>
						<div class="card card-bordered shadow-none mb-2">
													<!-- card body -->
													<div class="card-body p-6">
													<div id="payment-method"></div><!-- 토스페이 결제등등  -->
													   <div id="agreement"></div><!-- 이용약관 -->
<!-- 														<div class="d-flex"> -->
<!-- 															<div class="form-check"> -->
<!-- 																checkbox -->
<!-- 																<input class="form-check-input" type="radio" checked -->
<!-- 																	name="flexRadioDefault" id="paypal" /> -->
<!-- 																<label class="form-check-label ms-2" -->
<!-- 																	for="paypal"></label> -->
<!-- 															</div> -->
<!-- 															<div> -->
<!-- 																title -->
<!-- 																<h5 class="mb-1 "><img src="/user/template/assets/images/logo/TossPay_Logo_Primary.png" alt="" width="200"> 토스페이</h5> -->
<!-- 																<p class="mb-0 small"></p> -->
<!-- 															</div> -->
<!-- 														</div> -->
													</div>
												</div>
						<div class="mt-5 d-flex justify-content-end">
													<a href="" class="btn btn-outline-gray-400 text-muted"
														data-bs-toggle="collapse" data-bs-target="#flush-collapseThree"
														aria-expanded="false" aria-controls="flush-collapseThree">
														이전
													</a>
													<button type="button" id="payment-button"  class="btn btn-primary ms-2">결제하기</button>
												</div>
						</div>
				</div>
				<div class="col-lg-4">
					<div class="card bg-light bg-opacity-25 mb-4">
						<div class="card-header px-4 py-3">
							<h3 class="fs-5 mb-0">예약자 정보</h3>
						</div>
						<div class="card-body px-4">
							
							<div class="mb-2 border-top pt-3 mb-2">
								<div class="d-flex align-items-center justify-content-between mb-2">
									<span>예약자 성함</span>
									<span id="reservName" th:text="${reservationData.reservName}" class="text-dark fw-medium">안세찬</span>
								</div>
								<div class="d-flex align-items-center justify-content-between mb-2">
									<span>예약자 전화번호</span>
									<span id="reservTell" th:text="${reservationData.reservTell}" class="text-dark fw-medium">010-2732-3772</span>
								</div>
								
								
							</div>
							
						</div>
					</div>
					<!--Order summary-->
					<div class="card bg-light bg-opacity-25 mb-4">
						<div class="card-header px-4 py-3">
							<h3 class="fs-5 mb-0">예약 요약</h3>
						</div>
						<div class="card-body px-4">
							<div class="d-flex justify-content-between mb-4">
								<div class="d-flex align-items-start gap-3 flex-wrap">
									<a href="#!"><img th:src="${item.roomPic}"
											alt="product image" class="border" width="60" /></a>

									<div class="mb-2">
										<h3 id="roomName" th:text="${item.roomName}"class="fs-6 mb-1 text-link"><a href="#!">루아보(LUABO) 스튜디오</a></h3>

										
									</div>
								</div>
								
							</div>
							<div class="mb-2 border-top pt-3 mb-2">
								<div class="d-flex align-items-center justify-content-between mb-2">
									<span>연습실 가격</span>
									<span th:text="'￦'+${#numbers.formatDecimal((reservationData.pricePerHour != null ? reservationData.pricePerHour : 0) / 1000.0, 1, 3)} + ' /시간'" class="text-dark fw-medium">￦4000원/시간</span>
								</div>
								<div class="d-flex align-items-center justify-content-between mb-2">
									<span>사용 시간</span>
									<span th:text="${reservationData.reservTime} + '시간'" class="">2시간</span>
								</div>
								<div class="d-flex align-items-center justify-content-between mb-2">
									<span>예약 날짜</span>
									<span th:text="${reservationData.reservDate}" class="">2025-02-25</span>
								</div>
								
							</div>
							<div
								class="d-flex align-items-center justify-content-between border-top pt-3 mb-2 fw-medium text-dark">
								<span class="me-1" >총 결제액 (KRW)</span>
								<span id="TotalPrice" th:text="'￦'+${#numbers.formatDecimal((reservationData.totalPrice != null ? reservationData.totalPrice : 0) / 1000.0, 1, 3)} " class="">￦8000원</span>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	<!--Shopping checkout end-->
	<script src="/user/template/FreshCart-1.4.0/assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
	<!-- Swiper JS -->
	<script src="/user/template/FreshCart-1.4.0/assets/libs/swiper/swiper-bundle.min.js"></script>
	<script src="/user/template/FreshCart-1.4.0/assets/libs/simplebar/dist/simplebar.min.js"></script>

	<!-- Theme JS -->
	<script src="/user/template/FreshCart-1.4.0/assets/js/theme.min.js"></script>

	<!-- Swiper JS -->
	<script src="/user/template/FreshCart-1.4.0/assets/libs/swiper/swiper-bundle.min.js"></script>
	<script src="/user/template/FreshCart-1.4.0/assets/js/vendors/swiper.js"></script>
	<script src="/user/template/FreshCart-1.4.0/assets/libs/drift-zoom/dist/Drift.min.js"></script>
	<script src="/user/template/FreshCart-1.4.0/assets/js/vendors/drift.js"></script>
	<script src="/user/template/FreshCart-1.4.0/assets/js/vendors/slide-hint-img.js"></script>
	<script src="/user/template/FreshCart-1.4.0/assets/js/vendors/flag.js"></script>
	<script src="/user/template/FreshCart-1.4.0/assets/js/vendors/color-change.js"></script>
	<script src="/user/template/FreshCart-1.4.0/assets/js/vendors/add-to-cart.js"></script>
	<script src="/user/template/FreshCart-1.4.0/assets/js/vendors/qty-input.js"></script>
	<script src="/user/template/FreshCart-1.4.0/assets/js/vendors/btn-scrolltop.js"></script>
	
	<script src="/xdm/template/craft_html_v1.1.6/assets/js/custom/jquery-3.7.1.min.js"></script>
	<script src="https://js.tosspayments.com/v2/standard"></script>
<script>
  window.addEventListener("DOMContentLoaded", () => {
    setTimeout(() => {
      main(); // HTML 다 그려진 후 main() 호출
    }, 0);
  });

  async function main() {
    const amount = Number(document.getElementById("TotalPrice")?.value);
    const stayName = document.getElementById("roomName")?.innerText;
    const checkInName = document.getElementById("reservName")?.innerText;
    const checkInTel = document.getElementById("reservTell")?.innerText;
    const orderId = document.getElementById("orderId")?.value;
    const customerKey = document.getElementById("userId")?.value;
    const button = document.getElementById("payment-button");

    // 디버깅 로그
    console.log({ amount, stayName, checkInName, checkInTel, orderId, customerKey, button });

    if (!amount || !orderId || !customerKey) {
      alert("결제 정보가 올바르지 않습니다.");
      return;
    }

    const clientKey = "test_gck_docs_Ovk5rk1EwkEbP0W43n07xlzm";
    const tossPayments = TossPayments(clientKey);
    const widgets = tossPayments.widgets({ customerKey });

    await widgets.setAmount({ currency: "KRW", value: amount });

    await Promise.all([
      widgets.renderPaymentMethods({
        selector: "#payment-method",
        variantKey: "DEFAULT",
      }),
      widgets.renderAgreement({
        selector: "#agreement",
        variantKey: "AGREEMENT",
      }),
    ]);

    console.log("✅ Toss 위젯 로드 완료");

    // ⬇️ 버튼 클릭 이벤트 등록
    if (button) {
      button.addEventListener("click", async function () {
        console.log("🟢 [클릭] 결제 버튼 눌림");

        await widgets.requestPayment({
          orderId,
          orderName: stayName,
          successUrl: window.location.origin + "/successPayments",
          failUrl: window.location.origin + "/failPayments",
          customerEmail: "test@example.com",
          customerName: checkInName,
          customerMobilePhone: checkInTel,
        });
      });
    } else {
      console.error("❗ 버튼 요소가 없습니다.");
    }
  }

</script>


</body>

</html>
  
    
	
	